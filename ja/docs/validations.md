# Validations

モデルのクラスにはバリデーションを設定することが可能です。バリデーションによって、モデルに保存することができるデータの種類を制限することができます。特にバリデーションが有効なのは ```store``` コレクションに対してですが、他でも利用することができます。

現在のところ、以下のバリデーションが実装されています (更に追加される予定です)。

- length
- present
- email
- format
- numericality
- phone number
- unique

より詳細な内容については、[このフォルダー](https://github.com/voltrb/volt/tree/master/lib/volt/models/validators) を参照してください。

```ruby
    class Info < Volt::Model
      validate :name, length: 5
      validate :state, presence: true
    end
```

バリデーションがある場合、ここでバッファに対して ```save!``` を実行すると、以下のようになります:

1. クライアントサイトでバリデーションが実行されます。もしバリデーションがエラーになった場合、```save!``` の結果の promise がエラーオブジェクトを伴って reject されます。
2. データはサーバーに送られ、クライアントサイドとサーバーサイドのバリデーションがサーバー上で実行されます。すべてのエラーが返され、promise はフロントエンドで (エラーオブジェクトを伴って) reject されます。
    - バリデーションがサーバーサイドでも再度実行されることで、バリデーションにパスしないデータが保存されてしまうことを確実に回避します。
3. すべてのバリデーションにパスすると、データはデータベースに保存され、promise はクライアント上で resolve されます。
4. データが他のすべてのクライアントと同期されます。

## カスタムバリデーション

バリデートのためのブロックを渡すことで、カスタムのバリデーションを設定することができます。

```ruby
validate do

  if _name.present?
    {name: 'must be present'}
  else
    {}
  end
end
```

ブロックはエラーのハッシュを返す必要があります。キーはそれぞれ、フィールドのエラーメッセージに対応します。複数のエラーを返すことも可能で、その場合、それらのエラーはマージされます。

## カスタムバリデーター

TODO: Document custom validator classes
